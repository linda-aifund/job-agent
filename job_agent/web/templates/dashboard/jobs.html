{% extends "base.html" %}
{% block title %}All Jobs â€” Job Agent{% endblock %}

{% block content %}
<h1 style="margin-bottom: 8px;">All Tracked Jobs</h1>
<p style="color: var(--text-muted); font-size: 14px; margin-bottom: 16px;">
    {{ total }} jobs total &middot; Page {{ page }} of {{ total_pages }}
</p>

<div style="margin-bottom: 16px;">
    Sort by:
    <a href="/dashboard/jobs?sort=score" class="btn btn-sm {% if sort == 'score' %}btn-primary{% else %}btn-secondary{% endif %}">Score</a>
    <a href="/dashboard/jobs?sort=date" class="btn btn-sm {% if sort == 'date' %}btn-primary{% else %}btn-secondary{% endif %}">Date</a>
    <a href="/dashboard/jobs?sort=source" class="btn btn-sm {% if sort == 'source' %}btn-primary{% else %}btn-secondary{% endif %}">Source</a>
</div>

<div class="card" style="padding: 0;">
<div class="table-wrap">
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Company</th>
            <th>Location</th>
            <th>Score</th>
            <th>Source</th>
            <th>Seen</th>
            <th>Emailed</th>
        </tr>
    </thead>
    <tbody>
        {% for job in jobs %}
        <tr>
            <td>
                {% if job.url %}
                <a href="{{ job.url }}" target="_blank">{{ job.title }}</a>
                {% else %}
                {{ job.title }}
                {% endif %}
            </td>
            <td>{{ job.company }}</td>
            <td>{{ job.location }}</td>
            <td>
                {% set score_pct = (job.match_score * 100) | int %}
                <span class="score-badge {% if score_pct >= 70 %}score-high{% elif score_pct >= 40 %}score-medium{% else %}score-low{% endif %}">
                    {{ score_pct }}%
                </span>
            </td>
            <td>{{ job.source }}</td>
            <td>{{ job.first_seen_at.strftime('%b %d') }}</td>
            <td>{{ 'Yes' if job.sent_at else '' }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
</div>

{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="/dashboard/jobs?page={{ page - 1 }}&sort={{ sort }}">&laquo; Prev</a>
    {% endif %}
    {% for p in range(1, total_pages + 1) %}
        {% if p == page %}
        <span class="active">{{ p }}</span>
        {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
        <a href="/dashboard/jobs?page={{ p }}&sort={{ sort }}">{{ p }}</a>
        {% elif p == 4 or p == total_pages - 3 %}
        <span>&hellip;</span>
        {% endif %}
    {% endfor %}
    {% if page < total_pages %}
    <a href="/dashboard/jobs?page={{ page + 1 }}&sort={{ sort }}">Next &raquo;</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
